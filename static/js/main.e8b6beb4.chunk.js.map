{"version":3,"sources":["components/time.ts","components/items.ts","components/clock.tsx","components/upcoming-delta.ts","components/controls.tsx","components/item.tsx","components/timeline.tsx","App.tsx","index.tsx"],"names":["atTimeToDiff","atTime","hour","minutes","now","Date","atDate","getFullYear","getMonth","getDate","getTime","formatMilliseconds","ms","sign","Math","abs","frames","String","floor","padStart","seconds","useItems","useQuery","updateItems","a","items","item","late","delta","undefined","completed","diff","afterMinutes","relativeTo","completedAt","updated","forEach","fetch","res","json","i","toggleCompleted","relativeToIndex","length","setInterval","staleTime","Infinity","Clock","useState","time","setTime","data","setDelta","setLate","useEffect","timer","upcomingItem","find","clearInterval","useUpcomingDelta","toLocaleTimeString","className","Controls","onClick","window","location","reload","Item","setCompleted","push","index","indexOf","splice","image","target","rel","stopPropagation","href","dangerouslySetInnerHTML","__html","message","e","Timeline","isLoading","error","map","queryClient","QueryClient","App","QueryClientProvider","client","ReactDOM","render","document","getElementById"],"mappings":"kSAAO,SAASA,EAAaC,GAC3B,IAAMC,EAAOD,EAAS,IAAM,EACtBE,EAAUF,EAAS,IACnBG,EAAM,IAAIC,KACVC,EAAS,IAAID,KAAKD,EAAIG,cAAeH,EAAII,WAAYJ,EAAIK,UAAWP,EAAMC,EAAS,EAAG,GAC5F,OAAOC,EAAIM,UAAYJ,EAAOI,UAGzB,SAASC,EAAmBC,GACjC,GAAW,OAAPA,EAAJ,CAGA,IAAMC,EAAOD,EAAK,EAAI,KAAO,KAC7BA,EAAKE,KAAKC,IAAIH,GACd,IAAMI,EAASC,OAAOH,KAAKI,MAAON,EAAK,KAAS,IAAO,MAAMO,SAAS,EAAG,KACnEC,EAAUH,OAAOH,KAAKI,MAAON,EAAK,IAAQ,KAAKO,SAAS,EAAG,KAC3DhB,EAAUc,OAAOH,KAAKI,MAAON,EAAK,IAAO,GAAM,KAAKO,SAAS,EAAG,KACtE,MAAM,GAAN,OAAWN,GAAX,OAAoBV,EAApB,YAAiCiB,EAAjC,YAA8CJ,ICKzC,SAASK,IACd,OAAOC,YAAyB,iBAAjB,sBAAmC,yBAoBvCC,EApBuC,SAAAC,EAAA,6DAoBvCD,EApBuC,WAoBxB,IAAD,gBACFE,GADE,IACrB,2BAA0B,CAAC,IAAD,EAAfC,EAAe,QAIxB,GAHAA,EAAKC,MAAO,EACZD,EAAKE,WAAQC,EAETH,EAAKI,gBACF,GAAIJ,EAAKzB,OAAQ,CACtB,IAAM8B,EAAO/B,EAAa0B,EAAKzB,QAC/ByB,EAAKC,KAAOI,EAAO,EACnBL,EAAKE,MAAQjB,EAAmBoB,QAC3B,QAA0BF,IAAtBH,EAAKM,eAAL,UAAmCN,EAAKO,kBAAxC,aAAmC,EAAiBH,YACzDJ,EAAKO,WAAWC,YAAa,CAC/B,IAAMH,EAAO1B,KAAKD,MAAQsB,EAAKO,WAAWC,YAAkC,GAApBR,EAAKM,aAAoB,IACjFN,EAAKC,KAAOI,EAAO,EACnBL,EAAKE,MAAQjB,EAAmBoB,GAGpCL,EAAKS,QAAQC,SAAQ,SAAAD,GAAO,OAAIA,QAjBb,gCApByB,SAC9BE,MAAM,yBADwB,cAC1CC,EAD0C,gBAEnBA,EAAIC,OAFe,OAIhD,IAFMd,EAF0C,kBAIvCe,GACP,IAAMd,EAAOD,EAAMe,GACnBd,EAAKI,WAAY,EACjBJ,EAAKS,QAAU,GACfT,EAAKe,gBAAkB,WACrBf,EAAKI,WAAaJ,EAAKI,UACvBJ,EAAKQ,YAAcR,EAAKI,UAAYzB,KAAKD,WAAQyB,EACjDH,EAAKS,QAAQC,SAAQ,SAAAD,GAAO,OAAIA,aAELN,IAAzBH,EAAKgB,kBACPhB,EAAKO,WAAaR,EAAMe,EAAId,EAAKgB,mBAV5BF,EAAI,EAAGA,EAAIf,EAAMkB,OAAQH,IAAM,EAA/BA,GAJuC,OAkBhDI,YAAYrB,EAAa,IAAO,IAlBgB,kBAyCzCE,GAzCyC,4CA0C/C,CAAEoB,UAAWC,M,WC7DX,SAASC,IACd,MAAwBC,mBAAS,IAAjC,mBAAOC,EAAP,KAAaC,EAAb,KACA,ECHK,WACL,IAAczB,EAAUJ,IAAhB8B,KACR,EAA0BH,qBAA1B,mBAAOpB,EAAP,KAAcwB,EAAd,KACA,EAAwBJ,qBAAxB,mBAAOrB,EAAP,KAAa0B,EAAb,KAgBA,OAdAC,qBAAU,WACR,IAAMC,EAAQX,aAEd,WACE,IAAMY,EAAY,OAAG/B,QAAH,IAAGA,OAAH,EAAGA,EAAOgC,MAAK,SAAA/B,GAAI,OAAIA,EAAKE,SAC9CwB,EAAQ,OAACI,QAAD,IAACA,OAAD,EAACA,EAAc5B,OACvByB,EAAO,OAACG,QAAD,IAACA,OAAD,EAACA,EAAc7B,QALqB,IAAO,IAQpD,OAAO,WACL+B,cAAcH,MAEf,CAAC9B,IAEG,CAAEG,QAAOD,QDhBQgC,GAAhB/B,EAAR,EAAQA,MAAOD,EAAf,EAAeA,KAYf,OAVA2B,qBAAU,WACR,IAAMC,EAAQX,aAAY,WACxB,IAAMxC,EAAM,IAAIC,KAChB6C,EAAQ9C,EAAIwD,wBACX,IAAO,IACV,OAAO,WACLF,cAAcH,MAEf,IAGD,qBAAKM,UAAY,SAAWlC,EAAO,QAAU,IAA7C,SACIC,GAASqB,I,MEjBV,SAASa,IACd,OACE,qBAAKD,UAAU,WAAWE,QAAU,kBAAMC,OAAOC,SAASC,UAA1D,SACE,6CCHC,SAASC,EAAT,GAA0C,IAA1BzC,EAAyB,EAAzBA,KACrB,EAA0BsB,qBAA1B,mBAAOpB,EAAP,KAAcwB,EAAd,KACA,EAAwBJ,qBAAxB,mBAAOrB,EAAP,KAAa0B,EAAb,KACA,EAAkCL,qBAAlC,mBAAOlB,EAAP,KAAkBsC,EAAlB,KAiBA,OAfAd,qBAAU,WACR,IAAMnB,EAAU,WACdiB,EAAS1B,EAAKE,OACdyB,EAAQ3B,EAAKC,MACbyC,EAAa1C,EAAKI,YAGpB,OADAJ,EAAKS,QAAQkC,KAAKlC,GACX,WACL,IAAMmC,EAAQ5C,EAAKS,QAAQoC,QAAQpC,GAC/BmC,GAAS,GACX5C,EAAKS,QAAQqC,OAAOF,EAAO,MAG9B,CAAC5C,EAAM0B,EAAUgB,IAGlB,qBACEP,UAAY,QACTlC,EAAO,QAAU,KACjBG,EAAY,aAAe,IAE9BiC,QAAUrC,EAAKe,gBALjB,UAOE,qBAAKoB,UAAU,cAAf,SACI/B,EACE,mBAAG+B,UAAU,wBACbjC,IAEEF,EAAK+C,MACH,mBACAZ,UAAU,oCACVa,OAAO,SACPC,IAAI,aACJZ,QAAUa,EACVC,KAAOnD,EAAK+C,MALZ,SAMD,sBAAMZ,UAAU,UAAhB,yBACChC,KAGV,qBAAKgC,UAAU,UACViB,wBAA0B,CAAEC,OAAQrD,EAAKsD,cAKpD,SAASJ,EAAgBK,GACvBA,EAAEL,kB,MCjDG,SAASM,IACd,MAA0C7D,IAAlC8D,EAAR,EAAQA,UAAWC,EAAnB,EAAmBA,MAAa3D,EAAhC,EAA0B0B,KAE1B,OAAIgC,EACK,oBAAItB,UAAU,WAAd,SACL,oBAAIA,UAAU,OAAd,SACE,qBAAKA,UAAU,cAAf,4BAKFuB,IAAU3D,EACL,oBAAIoC,UAAU,WAAd,SACL,oBAAIA,UAAU,OAAd,SACE,qBAAKA,UAAU,cAAf,SAA+BuB,GAAS,8BAM5C,oBAAIvB,UAAU,WAAd,SACIpC,EAAM4D,KAAI,SAAC3D,EAAM4C,GAAP,OACV,cAACH,EAAD,CAAoBzC,KAAOA,GAAf4C,QCrBpB,IAAMgB,EAAc,IAAIC,IAEjB,SAASC,IACd,OACE,qBAAK3B,UAAU,MAAf,SACE,eAAC4B,EAAA,EAAD,CAAqBC,OAASJ,EAA9B,UACE,cAACvC,EAAD,IACA,cAACe,EAAD,IACA,cAACoB,EAAD,S,MCTRS,IAASC,OAAO,cAACJ,EAAD,IAASK,SAASC,eAAe,W","file":"static/js/main.e8b6beb4.chunk.js","sourcesContent":["export function atTimeToDiff(atTime: number): number {\n  const hour = atTime / 100 | 0;\n  const minutes = atTime % 100;\n  const now = new Date();\n  const atDate = new Date(now.getFullYear(), now.getMonth(), now.getDate(), hour, minutes, 0, 0);\n  return now.getTime() - atDate.getTime();\n}\n\nexport function formatMilliseconds(ms: null | number): string | undefined {\n  if (ms === null) {\n    return undefined;\n  }\n  const sign = ms < 0 ? 'T-' : 'T+';\n  ms = Math.abs(ms);\n  const frames = String(Math.floor((ms % 1000) / (1000 / 30))).padStart(2, '0');\n  const seconds = String(Math.floor((ms / 1000) % 60)).padStart(2, '0');\n  const minutes = String(Math.floor((ms / 1000 / 60) % 60)).padStart(2, '0');\n  return `${ sign }${ minutes }:${ seconds }:${ frames }`;\n}\n","import { useQuery } from 'react-query';\nimport { atTimeToDiff, formatMilliseconds } from './time';\n\nexport interface IItem {\n  message: string;\n  image?: string;\n  atTime?: number;\n  afterMinutes?: number;\n\n  late?: boolean;\n  delta?: string;\n\n  completed?: boolean;\n  completedAt?: number;\n\n  relativeToIndex?: number;\n  relativeTo?: IItem;\n\n  toggleCompleted: () => void;\n  updated: Array<() => void>;\n}\n\nexport function useItems() {\n  return useQuery<IItem[], Error>('timeline-items', async () => {\n    const res = await fetch('/timeline/events.json');\n    const items: IItem[] = await res.json();\n\n    for (let i = 0; i < items.length; i++) {\n      const item = items[i];\n      item.completed = false;\n      item.updated = [];\n      item.toggleCompleted = () => {\n        item.completed = !item.completed;\n        item.completedAt = item.completed ? Date.now() : undefined;\n        item.updated.forEach(updated => updated());\n      };\n      if (item.relativeToIndex !== undefined) {\n        item.relativeTo = items[i + item.relativeToIndex];\n      }\n    }\n\n    setInterval(updateItems, 1000 / 60);\n\n    function updateItems() {\n      for (const item of items) {\n        item.late = false;\n        item.delta = undefined;\n\n        if (item.completed) {\n        } else if (item.atTime) {\n          const diff = atTimeToDiff(item.atTime);\n          item.late = diff > 0;\n          item.delta = formatMilliseconds(diff);\n        } else if (item.afterMinutes !== undefined && item.relativeTo?.completed) {\n          if (item.relativeTo.completedAt) {\n            const diff = Date.now() - item.relativeTo.completedAt - item.afterMinutes * 60 * 1000;\n            item.late = diff > 0;\n            item.delta = formatMilliseconds(diff);\n          }\n        }\n        item.updated.forEach(updated => updated());\n      }\n    }\n\n    return items;\n  }, { staleTime: Infinity });\n}\n","import React, { useEffect, useState } from 'react';\nimport './clock.scss';\nimport { useUpcomingDelta } from './upcoming-delta';\n\nexport function Clock() {\n  const [time, setTime] = useState('');\n  const { delta, late } = useUpcomingDelta();\n\n  useEffect(() => {\n    const timer = setInterval(() => {\n      const now = new Date();\n      setTime(now.toLocaleTimeString());\n    }, 1000 / 60);\n    return () => {\n      clearInterval(timer);\n    };\n  }, []);\n\n  return (\n    <div className={ 'clock' + (late ? ' late' : '') }>\n      { delta || time }\n    </div>\n  );\n}\n","import { useEffect, useState } from 'react';\nimport { useItems } from './items';\n\nexport function useUpcomingDelta() {\n  const { data: items } = useItems();\n  const [delta, setDelta] = useState<string>();\n  const [late, setLate] = useState<boolean>();\n\n  useEffect(() => {\n    const timer = setInterval(findFirstLateItem, 1000 / 60);\n\n    function findFirstLateItem() {\n      const upcomingItem = items?.find(item => item.delta);\n      setDelta(upcomingItem?.delta);\n      setLate(upcomingItem?.late);\n    }\n\n    return () => {\n      clearInterval(timer);\n    };\n  }, [items]);\n\n  return { delta, late };\n}\n","import React from \"react\";\nimport \"./controls.scss\";\n\nexport function Controls() {\n  return (\n    <div className=\"controls\" onClick={ () => window.location.reload() }>\n      <button>Reset</button>\n    </div>\n  );\n}\n","import React, { MouseEvent, useEffect, useState } from 'react';\nimport { IItem } from './items';\n\nexport function Item({ item }: { item: IItem }) {\n  const [delta, setDelta] = useState<string>();\n  const [late, setLate] = useState<boolean>();\n  const [completed, setCompleted] = useState<boolean>();\n\n  useEffect(() => {\n    const updated = () => {\n      setDelta(item.delta);\n      setLate(item.late);\n      setCompleted(item.completed);\n    };\n    item.updated.push(updated);\n    return () => {\n      const index = item.updated.indexOf(updated);\n      if (index >= 0) {\n        item.updated.splice(index, 1);\n      }\n    };\n  }, [item, setDelta, setCompleted]);\n\n  return (\n    <li\n      className={ 'item'\n      + (late ? ' late' : '')\n      + (completed ? ' completed' : '')\n      }\n      onClick={ item.toggleCompleted }\n    >\n      <div className=\"item-status\">\n        { completed\n          ? <i className=\"fal fa-check-circle\" />\n          : delta\n            ? delta\n            : item.image\n              ? <a\n                className=\"fal fa-question-circle item-image\"\n                target=\"_blank\"\n                rel=\"noreferrer\"\n                onClick={ stopPropagation }\n                href={ item.image }\n              ><span className=\"sr-only\">Help</span></a>\n              : undefined\n        }\n      </div>\n      <div className=\"message\"\n           dangerouslySetInnerHTML={ { __html: item.message } } />\n    </li>\n  );\n}\n\nfunction stopPropagation(e: MouseEvent) {\n  e.stopPropagation();\n}\n\n","import React from 'react';\nimport { Item } from './item';\nimport { useItems } from './items';\nimport './timeline.scss';\n\nexport function Timeline() {\n  const { isLoading, error, data: items } = useItems();\n\n  if (isLoading) {\n    return <ul className=\"timeline\">\n      <li className=\"item\">\n        <div className=\"item-status\">Loading...</div>\n      </li>\n    </ul>;\n  }\n\n  if (error || !items) {\n    return <ul className=\"timeline\">\n      <li className=\"item\">\n        <div className=\"item-status\">{ error || 'Failed to load items!' }</div>\n      </li>\n    </ul>;\n  }\n\n  return (\n    <ul className=\"timeline\">\n      { items.map((item, index) => (\n        <Item key={ index } item={ item } />\n      )) }\n    </ul>\n  );\n}\n","import React from 'react';\nimport { QueryClient, QueryClientProvider } from 'react-query';\nimport { Clock } from './components/clock';\nimport { Controls } from './components/controls';\nimport { Timeline } from './components/timeline';\n\nconst queryClient = new QueryClient();\n\nexport function App() {\n  return (\n    <div className=\"App\">\n      <QueryClientProvider client={ queryClient }>\n        <Clock />\n        <Controls />\n        <Timeline />\n      </QueryClientProvider>\n    </div>\n  );\n}\n\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { App } from './App';\nimport './index.scss';\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}