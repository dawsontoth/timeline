{"version":3,"sources":["components/time.ts","components/items.ts","components/clock.tsx","components/upcoming-delta.ts","components/controls.tsx","components/item.tsx","components/timeline.tsx","App.tsx","index.tsx"],"names":["atMinutesToDiff","atMinutes","now","Date","atDate","getFullYear","getMonth","getDate","getHours","getTime","formatMilliseconds","ms","sign","Math","abs","frames","String","floor","padStart","seconds","minutes","useItems","useQuery","updateItems","a","items","item","late","delta","undefined","completed","diff","afterMinutes","relativeTo","completedAt","updated","forEach","fetch","res","json","toggleCompleted","relativeToIndex","setInterval","staleTime","Infinity","Clock","useState","time","setTime","data","setDelta","setLate","useEffect","timer","upcomingItem","find","clearInterval","useUpcomingDelta","toLocaleTimeString","className","Controls","onClick","window","location","reload","Item","setCompleted","push","index","indexOf","splice","image","target","rel","href","dangerouslySetInnerHTML","__html","message","Timeline","isLoading","error","map","queryClient","QueryClient","App","QueryClientProvider","client","ReactDOM","render","document","getElementById"],"mappings":"kSAAO,SAASA,EAAgBC,GAC9B,IAAMC,EAAM,IAAIC,KACVC,EAAS,IAAID,KAAKD,EAAIG,cAAeH,EAAII,WAAYJ,EAAIK,UAAWL,EAAIM,WAAYP,EAAW,EAAG,GACxG,OAAOC,EAAIO,UAAYL,EAAOK,UAGzB,SAASC,EAAmBC,GACjC,GAAW,OAAPA,EAAJ,CAGA,IAAMC,EAAOD,EAAK,EAAI,KAAO,KAC7BA,EAAKE,KAAKC,IAAIH,GACd,IAAMI,EAASC,OAAOH,KAAKI,MAAON,EAAK,KAAS,IAAO,MAAMO,SAAS,EAAG,KACnEC,EAAUH,OAAOH,KAAKI,MAAON,EAAK,IAAQ,KAAKO,SAAS,EAAG,KAC3DE,EAAUJ,OAAOH,KAAKI,MAAON,EAAK,IAAO,GAAM,KAAKO,SAAS,EAAG,KACtE,MAAM,GAAN,OAAWN,GAAX,OAAoBQ,EAApB,YAAiCD,EAAjC,YAA8CJ,ICUzC,SAASM,IACd,OAAOC,YAAyB,iBAAjB,sBAAmC,2BAmBvCC,EAnBuC,SAAAC,EAAA,6DAmBvCD,EAnBuC,WAmBxB,IAAD,gBACFE,GADE,IACrB,2BAA0B,CAAC,IAAD,EAAfC,EAAe,QAIxB,GAHAA,EAAKC,MAAO,EACZD,EAAKE,WAAQC,EAETH,EAAKI,gBACF,GAAIJ,EAAKzB,UAAW,CACzB,IAAM8B,EAAO/B,EAAgB0B,EAAKzB,WAClCyB,EAAKC,KAAOI,EAAO,EACnBL,EAAKE,MAAQlB,EAAmBqB,QAC3B,QAA0BF,IAAtBH,EAAKM,eAAL,UAAmCN,EAAKO,kBAAxC,aAAmC,EAAiBH,YACzDJ,EAAKO,WAAWC,YAAa,CAC/B,IAAMH,EAAO5B,KAAKD,MAAQwB,EAAKO,WAAWC,YAAkC,GAApBR,EAAKM,aAAoB,IACjFN,EAAKC,KAAOI,EAAO,EACnBL,EAAKE,MAAQlB,EAAmBqB,GAGpCL,EAAKS,QAAQC,SAAQ,SAAAD,GAAO,OAAIA,QAjBb,gCAnByB,SAC9BE,MAAM,yBADwB,cAC1CC,EAD0C,gBAEnBA,EAAIC,OAFe,OAE1Cd,EAF0C,qBAI7BA,GAJ6B,IAIhD,IAJgD,iBAIrCC,EAJqC,QAK9CA,EAAKI,WAAY,EACjBJ,EAAKS,QAAU,GACfT,EAAKc,gBAAkB,WACrBd,EAAKI,WAAaJ,EAAKI,UACvBJ,EAAKQ,YAAcR,EAAKI,UAAY3B,KAAKD,WAAQ2B,EACjDH,EAAKS,QAAQC,SAAQ,SAAAD,GAAO,OAAIA,aAELN,IAAzBH,EAAKe,kBACPf,EAAKO,WAAaR,EAAMC,EAAKe,mBATjC,uBAA2B,IAJqB,qCAiBhDC,YAAYnB,EAAa,IAAO,IAjBgB,kBAwCzCE,GAxCyC,4CAyC/C,CAAEkB,UAAWC,M,WC/DX,SAASC,IACd,MAAwBC,mBAAS,IAAjC,mBAAOC,EAAP,KAAaC,EAAb,KACA,ECHK,WACL,IAAcvB,EAAUJ,IAAhB4B,KACR,EAA0BH,qBAA1B,mBAAOlB,EAAP,KAAcsB,EAAd,KACA,EAAwBJ,qBAAxB,mBAAOnB,EAAP,KAAawB,EAAb,KAgBA,OAdAC,qBAAU,WACR,IAAMC,EAAQX,aAEd,WACE,IAAMY,EAAY,OAAG7B,QAAH,IAAGA,OAAH,EAAGA,EAAO8B,MAAK,SAAA7B,GAAI,OAAIA,EAAKE,SAC9CsB,EAAQ,OAACI,QAAD,IAACA,OAAD,EAACA,EAAc1B,OACvBuB,EAAO,OAACG,QAAD,IAACA,OAAD,EAACA,EAAc3B,QALqB,IAAO,IAQpD,OAAO,WACL6B,cAAcH,MAEf,CAAC5B,IAEG,CAAEG,QAAOD,QDhBQ8B,GAAhB7B,EAAR,EAAQA,MAAOD,EAAf,EAAeA,KAYf,OAVAyB,qBAAU,WACR,IAAMC,EAAQX,aAAY,WACxB,IAAMxC,EAAM,IAAIC,KAChB6C,EAAQ9C,EAAIwD,wBACX,IAAO,IACV,OAAO,WACLF,cAAcH,MAEf,IAGD,qBAAKM,UAAY,SAAWhC,EAAO,QAAU,IAA7C,SACIC,GAASmB,I,MEjBV,SAASa,IACd,OACE,qBAAKD,UAAU,WAAWE,QAAU,kBAAMC,OAAOC,SAASC,UAA1D,SACE,6CCHC,SAASC,EAAT,GAA0C,IAA1BvC,EAAyB,EAAzBA,KACrB,EAA0BoB,qBAA1B,mBAAOlB,EAAP,KAAcsB,EAAd,KACA,EAAwBJ,qBAAxB,mBAAOnB,EAAP,KAAawB,EAAb,KACA,EAAkCL,qBAAlC,mBAAOhB,EAAP,KAAkBoC,EAAlB,KAiBA,OAfAd,qBAAU,WACR,IAAMjB,EAAU,WACde,EAASxB,EAAKE,OACduB,EAAQzB,EAAKC,MACbuC,EAAaxC,EAAKI,YAGpB,OADAJ,EAAKS,QAAQgC,KAAKhC,GACX,WACL,IAAMiC,EAAQ1C,EAAKS,QAAQkC,QAAQlC,GAC/BiC,GAAS,GACX1C,EAAKS,QAAQmC,OAAOF,EAAO,MAG9B,CAAC1C,EAAMwB,EAAUgB,IAGlB,qBACEP,UAAY,QACThC,EAAO,QAAU,KACjBG,EAAY,aAAe,IAE9B+B,QAAUnC,EAAKc,gBALjB,UAOE,qBAAKmB,UAAU,cAAf,SACI7B,EACE,mBAAG6B,UAAU,wBACb/B,IAEEF,EAAK6C,MACH,mBACAZ,UAAU,oCACVa,OAAO,SACPC,IAAI,aACJC,KAAOhD,EAAK6C,MAJZ,SAKD,sBAAMZ,UAAU,UAAhB,yBACC9B,KAGV,qBAAK8B,UAAU,UACVgB,wBAA0B,CAAEC,OAAQlD,EAAKmD,c,MC1C7C,SAASC,IACd,MAA0CzD,IAAlC0D,EAAR,EAAQA,UAAWC,EAAnB,EAAmBA,MAAavD,EAAhC,EAA0BwB,KAE1B,OAAI8B,EACK,oBAAIpB,UAAU,WAAd,SACL,oBAAIA,UAAU,OAAd,SACE,qBAAKA,UAAU,cAAf,4BAKFqB,IAAUvD,EACL,oBAAIkC,UAAU,WAAd,SACL,oBAAIA,UAAU,OAAd,SACE,qBAAKA,UAAU,cAAf,SAA+BqB,GAAS,8BAM5C,oBAAIrB,UAAU,WAAd,SACIlC,EAAMwD,KAAI,SAACvD,EAAM0C,GAAP,OACV,cAACH,EAAD,CAAoBvC,KAAOA,GAAf0C,QCrBpB,IAAMc,EAAc,IAAIC,IAEjB,SAASC,IACd,OACE,qBAAKzB,UAAU,MAAf,SACE,eAAC0B,EAAA,EAAD,CAAqBC,OAASJ,EAA9B,UACE,cAACrC,EAAD,IACA,cAACe,EAAD,IACA,cAACkB,EAAD,S,MCTRS,IAASC,OAAO,cAACJ,EAAD,IAASK,SAASC,eAAe,W","file":"static/js/main.43b54214.chunk.js","sourcesContent":["export function atMinutesToDiff(atMinutes: number): number {\n  const now = new Date();\n  const atDate = new Date(now.getFullYear(), now.getMonth(), now.getDate(), now.getHours(), atMinutes, 0, 0);\n  return now.getTime() - atDate.getTime();\n}\n\nexport function formatMilliseconds(ms: null | number): string | undefined {\n  if (ms === null) {\n    return undefined;\n  }\n  const sign = ms < 0 ? 'T-' : 'T+';\n  ms = Math.abs(ms);\n  const frames = String(Math.floor((ms % 1000) / (1000 / 30))).padStart(2, '0');\n  const seconds = String(Math.floor((ms / 1000) % 60)).padStart(2, '0');\n  const minutes = String(Math.floor((ms / 1000 / 60) % 60)).padStart(2, '0');\n  return `${ sign }${ minutes }:${ seconds }:${ frames }`;\n}\n","import { useQuery } from 'react-query';\nimport { atMinutesToDiff, formatMilliseconds } from './time';\n\nexport interface IItem {\n  message: string;\n  image?: string;\n  atMinutes?: number;\n  afterMinutes?: number;\n\n  late?: boolean;\n  delta?: string;\n\n  completed?: boolean;\n  completedAt?: number;\n\n  relativeToIndex?: number;\n  relativeTo?: IItem;\n\n  toggleCompleted: () => void;\n  updated: Array<() => void>;\n}\n\n// TODO: Observe Livestream Studio through remote API\n// TODO: Control Livestream Studio through remote API\n\nexport function useItems() {\n  return useQuery<IItem[], Error>('timeline-items', async () => {\n    const res = await fetch('/timeline/events.json');\n    const items: IItem[] = await res.json();\n\n    for (const item of items) {\n      item.completed = false;\n      item.updated = [];\n      item.toggleCompleted = () => {\n        item.completed = !item.completed;\n        item.completedAt = item.completed ? Date.now() : undefined;\n        item.updated.forEach(updated => updated());\n      };\n      if (item.relativeToIndex !== undefined) {\n        item.relativeTo = items[item.relativeToIndex];\n      }\n    }\n\n    setInterval(updateItems, 1000 / 60);\n\n    function updateItems() {\n      for (const item of items) {\n        item.late = false;\n        item.delta = undefined;\n\n        if (item.completed) {\n        } else if (item.atMinutes) {\n          const diff = atMinutesToDiff(item.atMinutes);\n          item.late = diff > 0;\n          item.delta = formatMilliseconds(diff);\n        } else if (item.afterMinutes !== undefined && item.relativeTo?.completed) {\n          if (item.relativeTo.completedAt) {\n            const diff = Date.now() - item.relativeTo.completedAt - item.afterMinutes * 60 * 1000;\n            item.late = diff > 0;\n            item.delta = formatMilliseconds(diff);\n          }\n        }\n        item.updated.forEach(updated => updated());\n      }\n    }\n\n    return items;\n  }, { staleTime: Infinity });\n}\n","import React, { useEffect, useState } from 'react';\nimport './clock.scss';\nimport { useUpcomingDelta } from './upcoming-delta';\n\nexport function Clock() {\n  const [time, setTime] = useState('');\n  const { delta, late } = useUpcomingDelta();\n\n  useEffect(() => {\n    const timer = setInterval(() => {\n      const now = new Date();\n      setTime(now.toLocaleTimeString());\n    }, 1000 / 60);\n    return () => {\n      clearInterval(timer);\n    };\n  }, []);\n\n  return (\n    <div className={ 'clock' + (late ? ' late' : '') }>\n      { delta || time }\n    </div>\n  );\n}\n","import { useEffect, useState } from 'react';\nimport { useItems } from './items';\n\nexport function useUpcomingDelta() {\n  const { data: items } = useItems();\n  const [delta, setDelta] = useState<string>();\n  const [late, setLate] = useState<boolean>();\n\n  useEffect(() => {\n    const timer = setInterval(findFirstLateItem, 1000 / 60);\n\n    function findFirstLateItem() {\n      const upcomingItem = items?.find(item => item.delta);\n      setDelta(upcomingItem?.delta);\n      setLate(upcomingItem?.late);\n    }\n\n    return () => {\n      clearInterval(timer);\n    };\n  }, [items]);\n\n  return { delta, late };\n}\n","import React from \"react\";\nimport \"./controls.scss\";\n\nexport function Controls() {\n  return (\n    <div className=\"controls\" onClick={ () => window.location.reload() }>\n      <button>Reset</button>\n    </div>\n  );\n}\n","import React, { useEffect, useState } from 'react';\nimport { IItem } from './items';\n\nexport function Item({ item }: { item: IItem }) {\n  const [delta, setDelta] = useState<string>();\n  const [late, setLate] = useState<boolean>();\n  const [completed, setCompleted] = useState<boolean>();\n\n  useEffect(() => {\n    const updated = () => {\n      setDelta(item.delta);\n      setLate(item.late);\n      setCompleted(item.completed);\n    };\n    item.updated.push(updated);\n    return () => {\n      const index = item.updated.indexOf(updated);\n      if (index >= 0) {\n        item.updated.splice(index, 1);\n      }\n    };\n  }, [item, setDelta, setCompleted]);\n\n  return (\n    <li\n      className={ 'item'\n      + (late ? ' late' : '')\n      + (completed ? ' completed' : '')\n      }\n      onClick={ item.toggleCompleted }\n    >\n      <div className=\"item-status\">\n        { completed\n          ? <i className=\"fal fa-check-circle\" />\n          : delta\n            ? delta\n            : item.image\n              ? <a\n                className=\"fal fa-question-circle item-image\"\n                target=\"_blank\"\n                rel=\"noreferrer\"\n                href={ item.image }\n              ><span className=\"sr-only\">Help</span></a>\n              : undefined\n        }\n      </div>\n      <div className=\"message\"\n           dangerouslySetInnerHTML={ { __html: item.message } } />\n    </li>\n  );\n}\n","import React from 'react';\nimport { Item } from './item';\nimport { useItems } from './items';\nimport './timeline.scss';\n\nexport function Timeline() {\n  const { isLoading, error, data: items } = useItems();\n\n  if (isLoading) {\n    return <ul className=\"timeline\">\n      <li className=\"item\">\n        <div className=\"item-status\">Loading...</div>\n      </li>\n    </ul>;\n  }\n\n  if (error || !items) {\n    return <ul className=\"timeline\">\n      <li className=\"item\">\n        <div className=\"item-status\">{ error || 'Failed to load items!' }</div>\n      </li>\n    </ul>;\n  }\n\n  return (\n    <ul className=\"timeline\">\n      { items.map((item, index) => (\n        <Item key={ index } item={ item } />\n      )) }\n    </ul>\n  );\n}\n","import React from 'react';\nimport { QueryClient, QueryClientProvider } from 'react-query';\nimport { Clock } from './components/clock';\nimport { Controls } from './components/controls';\nimport { Timeline } from './components/timeline';\n\nconst queryClient = new QueryClient();\n\nexport function App() {\n  return (\n    <div className=\"App\">\n      <QueryClientProvider client={ queryClient }>\n        <Clock />\n        <Controls />\n        <Timeline />\n      </QueryClientProvider>\n    </div>\n  );\n}\n\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { App } from './App';\nimport './index.scss';\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}